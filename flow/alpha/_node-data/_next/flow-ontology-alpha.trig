@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcat: <http://www.w3.org/ns/dcat#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix sh: <http://www.w3.org/ns/shacl#> .

<> a owl:Ontology ;
    rdfs:label "Semantic Flow Ontology (alpha)"@en ;
    rdfs:comment "Formal ontology for the Semantic Flow mesh architecture, defining the core structure for mesh repositories, nodes, and elements. The recommended prefix is 'flow'."@en .

#################################################################
#    Classes
#################################################################

<MeshResource> a owl:Class ;
    rdfs:comment "Abstract base class for all mesh resources. Provides fundamental properties for identification, metadata, and versioning in the Semantic Flow mesh architecture."@en ;
    rdfs:label "MeshResource"@en .

<FileResource> a owl:Class ;
    rdfs:subClassOf <MeshResource> ;
    rdfs:comment "File-based mesh resources."@en ;
    rdfs:label "FileResource"@en .

<FolderResource> a owl:Class ;
    rdfs:subClassOf <MeshResource> ;
    rdfs:comment "Folder-based mesh resources."@en ;
    rdfs:label "FolderResource"@en .

<MeshNode> a owl:Class ;
    rdfs:subClassOf <MeshResource> ;
    rdfs:comment "Structural units that organize and contain other MeshNodes. Nodes form the structure of the mesh. They have elements."@en ;
    rdfs:label "MeshNode"@en .

<Element> a owl:Class ;
    rdfs:subClassOf <MeshResource> ;
    rdfs:comment "Terminal resources that provide specific mesh functionality."@en ;
    rdfs:label "Element"@en .

<NamespaceNode> a owl:Class ;
    rdfs:subClassOf <MeshNode>, <FolderResource> ;
    rdfs:comment "Containers for other nodes. Identifiers for NamespaceNodes don't refer to things or concepts other than themselves."@en ;
    rdfs:label "NamespaceNode"@en .

<ReferenceNode> a owl:Class ;
    rdfs:subClassOf <MeshNode>, <FolderResource> ;
    rdfs:comment "Nodes refer to some 'thing' or concept other than themselves."@en ;
    rdfs:label "ReferenceNode"@en .

<DataNode> a owl:Class ;
    rdfs:subClassOf <MeshNode>, <FolderResource> ;
    rdfs:comment "Nodes that provide 'payload data'."@en ;
    rdfs:label "DataNode"@en .

<Flow> a owl:Class ;
    rdfs:subClassOf dcat:DatasetSeries, <Element> ;
    rdfs:comment "Abstract evolvable datasets for node metadata, reference data, payload data, and configuration data. Node flows are realized through flow snapshots that represent specific states or versions, so they are DatasetSeries."@en ;
    rdfs:label "Flow"@en .

<MetadataFlow> a owl:Class ;
    rdfs:subClassOf <Flow>, <FolderResource> ;
    rdfs:comment "Centralized per-node metadata management for nodes and their elements."@en ;
    rdfs:label "MetadataFlow"@en .

<ReferenceFlow> a owl:Class ;
    rdfs:subClassOf <Flow>, <FolderResource> ;
    rdfs:comment "Reference flows contain information about their targets, implementing the single referent principle."@en ;
    rdfs:label "ReferenceFlow"@en .

<DataFlow> a owl:Class ;
    rdfs:subClassOf <Flow>, <FolderResource> ;
    rdfs:comment "'Abstract dataset' flow elements that contain snapshots and information that forms the payload of data nodes."@en ;
    rdfs:label "DataFlow"@en .

<ConfigFlow> a owl:Class ;
    rdfs:subClassOf <Flow>, <FolderResource> ;
    rdfs:comment "Per-node config info for the flow-service."@en ;
    rdfs:label "ConfigFlow"@en .

<NodeHandle> a owl:Class ;
    rdfs:subClassOf <Element>, <FolderResource> ;
    rdfs:comment "Node handles have an interest referent: their parent node 'as a node' (as opposed to the thing/concept referred to by the parent)."@en ;
    rdfs:label "NodeHandle"@en .

<AssetTree> a owl:Class ;
    rdfs:subClassOf <Element>, <FolderResource>;
    rdfs:comment "Asset trees contain collections of files and directories that are not MeshResources."@en ;
    rdfs:label "AssetTree"@en .

<FlowSnapshot> a owl:Class ;
    rdfs:subClassOf <Element>, dcat:Dataset ;
    rdfs:comment "Snapshots represent distinct states of a node flow (dataset), and contain actual RDF data files (aka Distributions)."@en ;
    rdfs:label "FlowSnapshot"@en .

<CurrentSnapshot> a owl:Class ;
    rdfs:subClassOf <FlowSnapshot>, <FolderResource> ;
    rdfs:comment "Current stable version snapshot of a node flow, representing the active state of the flow."@en ;
    rdfs:label "CurrentSnapshot"@en .

<NextSnapshot> a owl:Class ;
    rdfs:subClassOf <FlowSnapshot>, <FolderResource> ;
    rdfs:comment "Draft version snapshot of a node flow, representing work-in-progress state."@en ;
    rdfs:label "NextSnapshot"@en .

<VersionSnapshot> a owl:Class ;
    rdfs:subClassOf <FlowSnapshot>, <FolderResource> ;
    rdfs:comment "Historical version snapshot of a node flow, representing a specific versioned snapshot."@en ;
    rdfs:label "VersionSnapshot"@en .

<DocumentationResource> a owl:Class ;
    rdfs:subClassOf <Element> ;
    rdfs:comment "Documentation files that provide human-readable information about mesh resources."@en ;
    rdfs:label "DocumentationResource"@en .

<Changelog> a owl:Class ;
    rdfs:subClassOf <DocumentationResource>, <FileResource> ;
    rdfs:comment "Changelog files that document version history and changes over time for mesh resources."@en ;
    rdfs:label "Changelog"@en .

<Readme> a owl:Class ;
    rdfs:subClassOf <DocumentationResource>, <FileResource> ;
    rdfs:comment "Readme files that provide introductory documentation and usage information for mesh resources."@en ;
    rdfs:label "Readme"@en .

<ResourcePage> a owl:Class ;
    rdfs:subClassOf <DocumentationResource>, <FileResource> ;
    rdfs:comment "Human-readable `index.html` pages that provide context and dereferencability for folder-based mesh resources."@en ;
    rdfs:label "ResourcePage"@en .


#################################################################
#    Object Properties
#################################################################

<hasElement> a owl:ObjectProperty ;
    rdfs:domain <MeshNode> ;
    rdfs:range <Element> ;
    rdfs:comment "Associates nodes with their supporting elements."@en ;
    rdfs:label "hasElement"@en .

<isHandleFor> a owl:ObjectProperty ;
    rdfs:domain <NodeHandle> ;
    rdfs:range <MeshNode> ;
    rdfs:comment "Indicates that a handle element provides identification and routing for a specific node. This property enables location-independent node access."@en ;
    rdfs:label "isHandleFor"@en .

<hasNodeHandle> a owl:ObjectProperty ;
    rdfs:domain <MeshNode> ;
    rdfs:range <NodeHandle> ;
    rdfs:comment "Associates a mesh node with its persistent handle identifier. This property enables node addressing without overloading the node's canonical, potentially-referring URL."@en ;
    rdfs:label "hasNodeHandle"@en .

<hasReferenceFlow> a owl:ObjectProperty ;
    rdfs:domain <MeshNode> ;
    rdfs:range <ReferenceFlow> ;
    rdfs:comment "Links mesh nodes to their reference flow."@en ;
    rdfs:label "hasReferenceFlow"@en .

<hasMetadataFlow> a owl:ObjectProperty ;
    rdfs:domain <MeshNode> ;
    rdfs:range <MetadataFlow> ;
    rdfs:comment "Links mesh nodes to their metadata flow."@en ;
    rdfs:label "hasMetadataFlow"@en .

<hasDataFlow> a owl:ObjectProperty ;
    rdfs:domain <MeshNode> ;
    rdfs:range <DataFlow> ;
    rdfs:comment "Links mesh nodes to their data flow."@en ;
    rdfs:label "hasDataFlow"@en .

<hasConfigFlow> a owl:ObjectProperty ;
    rdfs:domain <MeshNode> ;
    rdfs:range <ConfigFlow> ;
    rdfs:comment "Links mesh nodes to their config flow."@en ;
    rdfs:label "hasConfigFlow"@en .

<hasFlowSnapshot> a owl:ObjectProperty ;
    rdfs:domain <Flow> ;
    rdfs:range <FlowSnapshot> ;
    rdfs:comment "Associates a Flow with its snapshots. This property enables version management within flows."@en ;
    rdfs:label "hasFlowSnapshot"@en .

<hasResourcePage> a owl:ObjectProperty ;
    rdfs:domain <FolderResource> ;
    rdfs:range <ResourcePage> ;
    rdfs:comment "Associates a mesh resource with its resource page."@en ;
    rdfs:label "hasResourcePage"@en .

<hasReadme> a owl:ObjectProperty ;
    rdfs:domain <FolderResource> ;
    rdfs:range <Readme> ;
    rdfs:comment "Associates a mesh resource with its readme documentation file."@en ;
    rdfs:label "hasReadme"@en .

<hasChangelog> a owl:ObjectProperty ;
    rdfs:domain <FolderResource> ;
    rdfs:range <Changelog> ;
    rdfs:comment "Associates a mesh resource with its changelog documentation file."@en ;
    rdfs:label "hasChangelog"@en .

<duplicatesSnapshot> a owl:ObjectProperty ;
    rdfs:domain <CurrentSnapshot> ;
    rdfs:range <VersionSnapshot> ;
    rdfs:comment "Associates a current snapshot with the most recent version snapshot."@en ;
    rdfs:label "duplicatesSnapshot"@en .

#################################################################
#    Data Properties
#################################################################


#################################################################
#    Disjointness Axioms
#################################################################

###  MeshNode and Element are disjoint
[ a owl:AllDisjointClasses ;
    owl:members ( <MeshNode> <Element> )
] .

###  Node types are disjoint
[ a owl:AllDisjointClasses ;
    owl:members ( <NamespaceNode> <ReferenceNode> <DataNode> )
] .

###  Element types are disjoint
[ a owl:AllDisjointClasses ;
    owl:members ( <NodeHandle> <Flow> <FlowSnapshot> <AssetTree> <DocumentationResource> )
] .

###  Flow types are disjoint
[ a owl:AllDisjointClasses ;
    owl:members ( <MetadataFlow> <ReferenceFlow> <DataFlow> )
] .

###  Resource types are disjoint
[ a owl:AllDisjointClasses ;
    owl:members ( <FileResource> <FolderResource> )
] .

###  Documentation types are disjoint
[ a owl:AllDisjointClasses ;
    owl:members ( <Changelog> <Readme> <ResourcePage> )
] .

###  Snapshot types are disjoint
[ a owl:AllDisjointClasses ;
    owl:members ( <CurrentSnapshot> <NextSnapshot> <VersionSnapshot> )
] .


#################################################################
#    SHACL Constraints
#################################################################

# Abstract Classes

<FlowShape> a sh:NodeShape ;
    sh:targetClass <Flow> ;
    sh:not [ sh:class <Flow> ] ;  # No direct instances
    sh:message "Flow is abstract - use a specific subclass" .

<FlowSnapshotShape> a sh:NodeShape ;
    sh:targetClass <FlowSnapshot> ;
    sh:not [ sh:class <FlowSnapshot> ] ;
    sh:message "FlowSnapshot is abstract - use CurrentSnapshot, NextSnapshot, or VersionSnapshot" .

<DocumentationResourceShape> a sh:NodeShape ;
    sh:targetClass <DocumentationResource> ;
    sh:not [ sh:class <DocumentationResource> ] ;
    sh:message "DocumentationResource is abstract - use Changelog, Readme, or other specific subclass" .

# Every MeshNode gets a Handle and a MetadataFlow

<MeshNodeShape> a sh:NodeShape ;
   sh:targetClass <MeshNode> ;
   sh:property [
       sh:path <hasMetadataFlow> ;
       sh:class <MetadataFlow> ;
       sh:minCount 1 ;
       sh:maxCount 1 ;
       sh:message "Every MeshNode must have exactly one MetadataFlow"
   ] ;
   sh:property [
       sh:path <hasNodeHandle> ;
       sh:class <NodeHandle> ;
       sh:minCount 1 ;
       sh:maxCount 1 ;
       sh:message "Every MeshNode must have exactly one NodeHandle"
   ] .

# Node-specific flow constraints

<ReferenceNodeShape> a sh:NodeShape ;
   sh:targetClass <ReferenceNode> ;
   sh:property [
       sh:path <hasReferenceFlow> ;
       sh:class <ReferenceFlow> ;
       sh:minCount 1 ;
       sh:maxCount 1 ;
       sh:message "Every ReferenceNode must have exactly one ReferenceFlow"
   ] .

<DataNodeShape> a sh:NodeShape ;
   sh:targetClass <DataNode> ;
   sh:property [
       sh:path <hasDataFlow> ;
       sh:class <DataFlow> ;
       sh:minCount 1 ;
       sh:maxCount 1 ;
       sh:message "Every DataNode must have exactly one DataFlow"
   ] ;
   sh:property [
       sh:path <hasReferenceFlow> ;
       sh:class <ReferenceFlow> ;
       sh:minCount 0 ;
       sh:maxCount 1 ;
       sh:message "DataNode can have at most one ReferenceFlow"
   ] .

# Every FolderResource should have a ResourcePage

<FolderResourceShape> a sh:NodeShape ;
    sh:targetClass <FolderResource> ;
    sh:property [
        sh:path <hasResourcePage> ;
        sh:class <ResourcePage> ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Every FolderResource should have a ResourcePage"
    ] .

#################################################################
#    Annotations
#################################################################

###  Generated by the OWL API (version 4.5.29.2024-05-13T12:11:03Z) https://github.com/owlcs/owlapi
###  Semantic Flow Ontology Phase 1 - Core Structure Implementation
###  Implements foundational class hierarchy and properties for mesh architecture
